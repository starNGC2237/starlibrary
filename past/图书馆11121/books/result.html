<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../css/anchor.css">
    <link rel="stylesheet" type="text/css" href="../css/books/result.css">
    <title>搜索结果</title>
</head>
<body>
    <!--头部导航栏-->
    <div style="width: 100vw;height: 12vh;background-color: #4185F5; display: flex; align-items: center;justify-content: space-between;">
        <span style="font-size: 5vmin;margin-left:15vw;color: white;font-family: Georgia, 'Times New Roman', Times, serif;"><a href="https://starlibrary.online" class="footer">StarLibrary</a></span>
        <div style="margin-right: 15vw;">
            <ul style="list-style: none;margin: 0;padding: 0;display: flex;justify-content: flex-start; align-items: center;" >
                <div class="headPicture" style="background-image: url(../img/white/int.png);" >
                </div>
                <li class="li_margin">
                    <a href=""  class="footer" >English</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/time.png);" >
                </div>
                <li class="li_margin" >
                    <a href="" id="time" class="footer"id="time" >北京时间</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/user.png);" >
                </div>
                <li class="li_margin">
                    <a href="" class="footer" id="loginCookie_check" >登录</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/feedBack.png);" >
                </div>
                <li class="li_margin">
                    <a href="" class="footer" >反馈</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/search.png);" >
                </div>
            </ul> 
        </div>
    </div>
    <!--中间的部分-->
    <div style="width: 100vw;height: 150vh;background-color: #f2f3f5;display: flex;flex-direction: column;justify-content: space-between;">
        <!--搜索栏-->
        <div style="width: 100vw;height: 10vh;display: flex;align-items: center;">
            <div style="width: 80vw;height: 10vh; margin: 0 auto;display: flex;align-items: center;justify-content: center;" id="search_two">
                <input type="text" name="bookName" id="bookName" class="search_bookName" placeholder="输入所有书籍将显示所有书籍" v-on:keyup="enter">
                <input type="button" value="搜索" class="search_bookName_button" style="cursor: pointer;" onclick="beforeCheck();"  >
            </div>
        </div>
        <div style="width: 100vw;height: 135vh;background-color: #f2f3f5;display: flex;flex-direction: column;justify-content: space-around;" >
            <!--共搜索到 7 个，当前页面显示第 1 - 7个。-->
            <div style="width:95vw;height: 5vh;background-color: #f2f3f5;margin: 0 auto;text-align: center;display: flex;align-items: center;" id="tips">
                <span style='margin:0 auto'>共搜索到 0 个，当前页面显示第0 - 0个。</span>
            </div>
            <!--内容-->
            <div style="width:95vw;height: 130vh;background-color: #f2f3f5;margin: 0 auto;display: flex;align-items: center;">
                <!--导航栏-->
                <div style="width: 15vw;height: 130vh;background-color: #f2f3f5;">

                </div>
                <!--result内容-->
                <div style="width: 65vw;height: 130vh;background-color: #f2f3f5;display: flex;flex-direction: column;" id="content">
                    <div style="width: 60vw;height: 20vh;display: flex;align-items: center;">
                        <span style="margin: 0 auto;">没有结果</span> 
                    </div>
                </div>
                <!--导航栏-->
                <div style="width: 15vw;height: 130vh;background-color: #f2f3f5;">

                </div>
            </div>
        </div>
        <!--导航栏-->
        <div style="width: 100vw;height: 5vh;display: flex;align-items: center;" >
            <ul style="margin: 0 auto;list-style: none;display: flex;align-items: center;"id="li_result">
                <li>
                    &lsaquo;&lsaquo;
                </li>
                <li>
                    01
                </li>
                <li>
                    &rsaquo;&rsaquo;
                </li>
            </ul>
        </div>
    </div>
    <!--底部导航栏-->
    <div style="width: 100vw;height: 40vh;background-color:#181818;display: flex; align-items: center; justify-content: space-between;color: white; min-height: 190px;">
        <div  style="height: 30vh; width: 35vw;margin-left: 15vw;">
            <ul style="list-style: none;font-size: 2vmin;padding: 0;" >
                <li style="margin-bottom: 2vh;">
                    <span style="font-size: 5vmin;font-family: Georgia, 'Times New Roman', Times, serif;" >
                       <a href="https://starlibrary.online" class="footer" >StarLibrary</a> 
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                       © 2009-2019 <a href="https://starlibrary.online" class="footer" >starlibrary.com </a>版权所有
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        本网站仅供学习使用
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        ICP证：<a href="http://www.beian.miit.gov.cn" class="footer" >津ICP备20000024号</a> 
                    </span>  
                </li>
                <li class="li_footer">
                    <img src="../img/备案图标.png" alt="" height="15px"  >
                    <span>
                        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?spm=5176.12825654.7y9jhqsfz.111.54212c4aBH6Hwq" class="footer">苏公网安备 32021402001231号</a> 
                    </span> 
                </li>
            </ul>
        </div>
        <div  style="height: 30vh; width: 35vw;margin-right: 15vw; display: flex; justify-content: flex-end;">
            <div style=" margin: 0 auto;margin-top: 5vh;font-size: 2vmin;">
                <dl>
                    <dt id="first" >
                        本周开馆音乐：
                    </dt>
                    <dd>
                        Xenogenesis
                    </dd>
                </dl>
                <dl>
                    <dt id="last"> 
                        本周闭馆音乐：
                    </dt>
                    <dd>
                        Dreamer
                    </dd>
                </dl>
            </div>
            
        </div>
    </div>
</body>
<script src="../js/tools/jquery-3.4.1.js"></script>
<script src="../js/tools/vue.js"></script>
<script src="../js/cookie.js"></script>
<!--顶部导航栏和底部导航栏的js-->
<script>
    //中文的日期
    function startTime(){
        var today=new Date();
        var year=today.getFullYear();
        var month=today.getMonth()+1;
        var day=today.getDate();
        var hours=today.getHours();
        var minutes=today.getMinutes();
        var seconds=today.getSeconds();// add a zero in front of numbers<10
        minutes=checkTime(minutes);
        seconds=checkTime(seconds);
        $("#time").html(year+"年"+month+"月"+day+"日"+hours+":"+minutes+":"+seconds);
        setInterval("startTime()",1000)
    }
    function checkTime(i){
        if (i<10) {
            i="0" + i;
        }
        return i;
    }
    //加载在这里！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
    $(document).ready(function(){
        setInterval("startTime()",1000);
        weeks();
        checkCookie("userName");
    });
    //这里是检查登录情况！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
    function checkCookie(cname){
        var user = getCookie(cname);
        var nickName=getCookie("nickName");
        if (user != "") {
            document.getElementById('loginCookie_check').innerHTML=nickName;
            document.getElementById('loginCookie_check').href="https://starlibrary.online/user/message.html";
        }else{
            document.getElementById('loginCookie_check').href="https://starlibrary.online/user/login.html";
        }
    }
    function weeks(){
        var today=new Date();
        var first_day=first(today);
        var first_mouth=first_day.getMonth()+1;
        first_mouth=checkTime(first_mouth);
        var first_date=first_day.getDate();
        first_date=checkTime(first_date);
        var last_day=last(today);
        var last_mouth=last_day.getMonth()+1;
        last_mouth=checkTime(last_mouth);
        var last_date=last_day.getDate();
        last_date=checkTime(last_date);
        document.getElementById('first').innerHTML="本周("+first_mouth+"."+first_date+"~"+last_mouth+"."+last_date+")开馆音乐：";
        document.getElementById('last').innerHTML="本周("+first_mouth+"."+first_date+"~"+last_mouth+"."+last_date+")闭馆音乐：";
    }
    function first(today){
        var week = today.getDay();
        if(week==0){
            week=7;
        }
        today.setDate(today.getDate()-week+1);
        return today;
    }
    function last(today){
        var week = today.getDay();
        if(week==0){
        week=7;
        }
        today.setDate(today.getDate()-week+7);
        return today;
    }
</script>
<script>
    Vue.config.devtools = true;
    var vm=new Vue({
        el:'#search_two',
        data:{
            
        },
        methods:{
            enter:function(){
                setCookie("keyBook",$("#bookName").val(),"7");
                check();
            }
        }
    })
</script>
<!--搜索栏js相关-->
<script>
    //获得搜索栏的值，并写入keyBook中,并提交check
    function beforeCheck(){
        var k=$("#bookName").val();
        setCookie("keyBook",k,7);
        check()
    }
    //检查keyBook并提交搜索
    function check(){
        var key=getCookie("keyBook")
        if(key!=""){
            if(key=="想象文学书籍"||key=="论说类书籍"||key=="咨询类书籍"||key=="说明规则类书籍"||key=="人物传记书籍"||key=="工具书"){
                $("#bookName").val(key); 
                $.ajax({
                    type:"get",
                    url:"https://starlibrary.online/penghao/book/page2",
                    dataType:"json",
                    data:{
                        type:key
                    },
                    success:function(response){
                        if(response.data.total!=0){
                            var list=response.data.list;
                            $("#tips").empty();
                            $("#tips").append("<span style='margin:0 auto'>共搜索到 "+response.data.total+" 个，当前页面显示第"+(   (response.data.pageNum-1)*response.data.pageSize+1)+" - "+(response.data.size+     (response.data. pageNum-1)*response.data.pageSize)+"个。</span>")
                            console.log(response.data.list);
                            $("#content").empty();
                            for(var i=0;i<list.length;i++){
                                var tableRow=$("<div id='div"+i+"'></div>");
                                $("#content").append(tableRow);
                                var tableRow=$("<table id='table"+i+"'></table>");
                                $("#div"+i).append(tableRow);
                                var tableRow=$("<tbody id='tbody"+i+"'></tbody>");
                                $("#table"+i).append(tableRow);
                                var tableRow=$("<tr><th><a href='https://starlibrary.online/books/introdution.html'id='"+list[i].   bookName+"' target='_blank' class='blue_clock' onclick='keyInform(this);'>     《"     +list[i].   bookName+"》</a></th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>作者："+list[i].bookAuthor+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>出版社："+list[i].bookPublish+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>"+list[i].publishTime+"第一版</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>"+list[i].bookPlace+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>"+list[i].type+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                            } 
                        }else{
                            $("#tips").empty();
                            $("#tips").append("<span style='margin:0 auto'>共搜索到 0 个，当前页面显示第 0 个。</span>");
                            $("#content").empty();
                            $("#content").append("<div style='width: 60vw;height: 20vh;display: flex;align-items: center;'><span    style='margin: 0 auto;'>没有结果</span></div>");
                        }
                    },error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status);
                        console.log(XMLHttpRequest.readyState);
                        console.log(textStatus);
                    }
                });
            }else if(key=="所有书籍"){
                $.ajax({
                    type:"get",
                    url:"https://starlibrary.online/penghao/book/page",
                    dataType:"json",
                    success:function(response){
                        if(response.data.total!=0){
                            var list=response.data.list;
                            $("#tips").empty();
                            $("#tips").append("<span style='margin:0 auto'>共搜索到 "+response.data.total+" 个，当前页面显示第"+(   (response.data.pageNum-1)*response.data.pageSize+1)+" - "+(response.data.size+     (response.data. pageNum-1)*response.data.pageSize)+"个。</span>")
                            console.log(response.data.list);
                            $("#content").empty();
                            for(var i=0;i<list.length;i++){
                                var tableRow=$("<div id='div"+i+"'></div>");
                                $("#content").append(tableRow);
                                var tableRow=$("<table id='table"+i+"'></table>");
                                $("#div"+i).append(tableRow);
                                var tableRow=$("<tbody id='tbody"+i+"'></tbody>");
                                $("#table"+i).append(tableRow);
                                var tableRow=$("<tr><th><a href='https://starlibrary.online/books/introdution.html'id='"+list[i].   bookName+"' target='_blank' class='blue_clock' onclick='keyInform(this);'>     《"     +list[i].   bookName+"》</a></th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>作者："+list[i].bookAuthor+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>出版社："+list[i].bookPublish+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>"+list[i].publishTime+"第一版</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>"+list[i].bookPlace+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                                var tableRow=$("<tr><th>"+list[i].type+"</th></tr>");
                                $("#tbody"+i).append(tableRow);
                            } 
                        }else{
                            $("#tips").empty();
                            $("#tips").append("<span style='margin:0 auto'>共搜索到 0 个，当前页面显示第 0 个。</span>");
                            $("#content").empty();
                            $("#content").append("<div style='width: 60vw;height: 20vh;display: flex;align-items: center;'><span    style='margin: 0 auto;'>没有结果</span></div>");
                        }
                    
                    },error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status);
                        console.log(XMLHttpRequest.readyState);
                        console.log(textStatus);
                    }
                });
            }else{
                result(key,1);
                $("#bookName").val(key); 
            }
        }
    }
    //ajax提交搜索
    function result(Name,Numb){
        $.ajax({
            type:"get",
            url:"https://starlibrary.online/penghao/book/querybook",
            dataType:"json",
            data:{
                bookName:Name,
                pageNum:Numb
            },
            success:function(response){
                if(response.data.total!=0){
                    var list=response.data.list;
                    $("#tips").empty();
                    $("#tips").append("<span style='margin:0 auto'>共搜索到 "+response.data.total+" 个，当前页面显示第"+(   (response.data.pageNum-1)*response.data.pageSize+1)+" - "+(response.data.size+(response.data.pageNum-1)    *response.data.pageSize)+"个。</span>")
                    console.log(response.data.list);
                    $("#content").empty();
                    for(var i=0;i<list.length;i++){
                        var tableRow=$("<div id='div"+i+"'></div>");
                        $("#content").append(tableRow);
                        var tableRow=$("<table id='table"+i+"'></table>");
                        $("#div"+i).append(tableRow);
                        var tableRow=$("<tbody id='tbody"+i+"'></tbody>");
                        $("#table"+i).append(tableRow);
                        var tableRow=$("<tr><th><a href='https://starlibrary.online/books/introdution.html'id='"+list[i].bookName   +"' target='_blank' class='blue_clock' onclick='keyInform(this);'>《"     +list[i].bookName+"》</a></  th></tr>");
                        $("#tbody"+i).append(tableRow);
                        var tableRow=$("<tr><th>作者："+list[i].bookAuthor+"</th></tr>");
                        $("#tbody"+i).append(tableRow);
                        var tableRow=$("<tr><th>出版社："+list[i].bookPublish+"</th></tr>");
                        $("#tbody"+i).append(tableRow);
                        var tableRow=$("<tr><th>"+list[i].publishTime+"第一版</th></tr>");
                        $("#tbody"+i).append(tableRow);
                        var tableRow=$("<tr><th>"+list[i].bookPlace+"</th></tr>");
                        $("#tbody"+i).append(tableRow);
                        var tableRow=$("<tr><th>"+list[i].type+"</th></tr>");
                        $("#tbody"+i).append(tableRow);
                    } 
                }else{
                    $("#tips").empty();
                    $("#tips").append("<span style='margin:0 auto'>共搜索到 0 个，当前页面显示第 0 个。</span>");
                    $("#content").empty();
                    $("#content").append("<div style='width: 60vw;height: 20vh;display: flex;align-items: center;'><span    style='margin: 0 auto;'>没有结果</span></div>");
                }
            
            },error : function(XMLHttpRequest, textStatus, errorThrown) {
                console.log(XMLHttpRequest.status);
                console.log(XMLHttpRequest.readyState);
                console.log(textStatus);
            }
        });
    }
    //进入之后检测keyBook
    check();
    $("#bookName").val(getCookie("keyBook"))
</script>
<!--跳转书籍详情-->
<script>
    function keyInform(element){
        console.log(element.id);
        setCookie("keyInform",element.id,7)
    }
</script>
<!--超时js-->
<script>
    var lastTime = new Date().getTime();
        var currentTime = new Date().getTime();
        var timeOut = 20* 60 * 1000; //设置超时时间： 20分

        $(function(){
            /* 鼠标移动事件 */
            $(document).mouseover(function(){
                lastTime = new Date().getTime(); //更新操作时间

            });
        });

        function testTime(){
            currentTime = new Date().getTime(); //更新当前时间
            if(currentTime - lastTime > timeOut){ //判断是否超时
                window.location.href="https://starlibrary.online/timeout.html"
            }
        }

        /* 定时器  间隔1秒检测是否长时间未操作页面  */
        window.setInterval(testTime, 1000);
</script>
</html>