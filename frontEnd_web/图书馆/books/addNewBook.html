<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../css/anchor.css">
    <link rel="stylesheet" type="text/css" href="../css/books/result.css">
    <title>新增书籍</title>
</head>
<body>
    <!--头部导航栏-->
    <div style="width: 100vw;height: 12vh;background-color: #181818; display: flex; align-items: center;justify-content: space-between;">
        <span style="font-size: 5vmin;margin-left:15vw;color: white;font-family: Georgia, 'Times New Roman', Times, serif;"><a href="https://starlibrary.online" class="footer">StarLibrary</a></span>
        <div style="margin-right: 15vw;">
            <ul style="list-style: none;margin: 0;padding: 0;display: flex;justify-content: flex-start; align-items: center;" >
                <div class="headPicture" style="background-image: url(../img/white/int.png);" >
                </div>
                <li class="li_margin">
                    <a href=""  class="footer" >English</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/time.png);" >
                </div>
                <li class="li_margin" >
                    <a href="" id="time" class="footer"id="time" >北京时间</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/user.png);" >
                </div>
                <li class="li_margin">
                    <a href="" class="footer" id="loginCookie_check" >登录</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/feedBack.png);" >
                </div>
                <li class="li_margin">
                    <a href="../feedBack.html" class="footer" >反馈</a>
                </li>
                <div class="headPicture" style="background-image: url(../img/white/search.png);" >
                </div>
            </ul> 
        </div>
    </div>
    <!--中间的部分-->
    <div style="width: 100vw;height: 88vh;background-color: #f2f3f5;display: flex;align-items: center;">
        <div style="width: 65vw;height: 80vh;background-color: #181818;margin: 0 auto;display: flex;justify-content: space-around;align-items: center;">
            <div style="width: 20vw;height: 70vh;display: flex;flex-direction: column;">
                <div style="width: 20vw;height: 5vh;background-color: blue;display: flex;align-items: center;">
                    <form id= "uploadForm" enctype ="multipart/form-data" >
                    <div style="width: 20vw;height: 5vh;display: flex;align-items: center;">
                        <input type ="file" name="file" onchange="changepic(this)" style="width: 15vw;" accept="imagepng, image/jpeg, image/gif, image/jpg"/>
                        <input type="hidden" name="bookId" value="none" id="description">
                        <input type ="button" value="上传" onclick="before_up()" style="position: absolute;bottom: 18vh;right: 36vw;"/>
                    </div>
                    </form>
                </div>
                <div style="width: 20vw;height: 65vh;background-color: #f2f3f5;background-image: url();background-position: center;background-size: cover;background-repeat: no-repeat;" id="show">
                </div>
            </div>
            <div style="width: 40vw;height: 70vh;background-color: #f2f3f5;display: flex;flex-direction: column;align-items: center;" id="input_b">
                <input type="text" name="" id="bookName" class="input_b" style="margin-top: 5vh;" placeholder="书名">
                <input type="text" name="" id="bookAuthor" class="input_b" placeholder="著者">
                <input type="text" name="" id="bookPublish" class="input_b" placeholder="出版社">
                <input type="date" name="" id="publishTime" class="input_b" placeholder="出版时间">
                <input type="number" name="" id="bookNumber" class="input_b" placeholder="数量">
                <input type="text" name="" id="bookPage" class="input_b" placeholder="页数">
                <input type="text" name="" id="bookIntroduction" class="input_b" placeholder="简介">
                <select name="" id="bookPlace" style="width: 15.5vw;height: 3.5vh;margin-bottom: 2vh;">
                    <option value="none">==请选择楼层==</option>
                </select>
                <select name="" id="type" style="width: 15.5vw;height: 3.5vh;margin-bottom: 2vh;">
                    <option value="none">==请选择书籍类型==</option>
                    <option value="想象文学">想象文学</option>
                    <option value="论说类书籍">论说类书籍</option>
                    <option value="咨询类书籍">咨询类书籍</option>
                    <option value="说明规则类书籍">说明规则类书籍</option>
                    <option value="人物传记">人物传记</option>
                    <option value="工具书">工具书</option>
                </select>
            </div>
        </div>
    </div>
    <!--底部导航栏-->
    <div style="width: 100vw;height: 40vh;background-color:#181818;display: flex; align-items: center; justify-content: space-between;color: white; min-height: 190px;">
        <div  style="height: 30vh; width: 35vw;margin-left: 15vw;">
            <ul style="list-style: none;font-size: 2vmin;padding: 0;" >
                <li style="margin-bottom: 2vh;">
                    <span style="font-size: 5vmin;font-family: Georgia, 'Times New Roman', Times, serif;" >
                       <a href="https://starlibrary.online" class="footer" >StarLibrary</a> 
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                       © 2020-2021 <a href="https://starlibrary.online" class="footer" >starlibrary.com </a>版权所有
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        本网站仅供学习使用
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        ICP证：<a href="http://www.beian.miit.gov.cn" class="footer" >津ICP备20000024号</a> 
                    </span>  
                </li>
                <li class="li_footer">
                    <img src="../img/备案图标.png" alt="" height="15px"  >
                    <span>
                        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?spm=5176.12825654.7y9jhqsfz.111.54212c4aBH6Hwq" class="footer">苏公网安备 32021402001231号</a> 
                    </span> 
                </li>
            </ul>
        </div>
        <div  style="height: 30vh; width: 35vw;margin-right: 15vw; display: flex; justify-content: flex-end;">
            <div style=" margin: 0 auto;margin-top: 5vh;font-size: 2vmin;">
                <dl>
                    <dt id="first" >
                        本周开馆音乐：
                    </dt>
                    <dd>
                        Xenogenesis
                    </dd>
                </dl>
                <dl>
                    <dt id="last"> 
                        本周闭馆音乐：
                    </dt>
                    <dd>
                        Dreamer
                    </dd>
                </dl>
            </div>
            
        </div>
    </div>
</body>
<script src="../js/tools/jquery-3.4.1.js"></script>
<script src="../js/cookie.js"></script>
<!--顶部导航栏和底部导航栏的js-->
<script>
    //中文的日期
    function startTime(){
        var today=new Date();
        var year=today.getFullYear();
        var month=today.getMonth()+1;
        var day=today.getDate();
        var hours=today.getHours();
        var minutes=today.getMinutes();
        var seconds=today.getSeconds();// add a zero in front of numbers<10
        minutes=checkTime(minutes);
        seconds=checkTime(seconds);
        $("#time").html(year+"年"+month+"月"+day+"日"+hours+":"+minutes+":"+seconds);
        setInterval("startTime()",1000)
    }
    function checkTime(i){
        if (i<10) {
            i="0" + i;
        }
        return i;
    }
    
    //加载在这里！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
    $(document).ready(function(){
        setInterval("startTime()",1000);
        weeks();
        checkCookie("adminName");
    });
    //这里是检查登录情况！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
    function checkCookie(cname){
        var admin = getCookie(cname);
        var nickName=getCookie("adminNickName");
        if (admin != "") {
            document.getElementById('loginCookie_check').innerHTML=nickName;
        }else{
            window.location.href="https://starlibrary.online/user/admin/login.html";
        }
    }
    function weeks(){
        var today=new Date();
        var first_day=first(today);
        var first_mouth=first_day.getMonth()+1;
        first_mouth=checkTime(first_mouth);
        var first_date=first_day.getDate();
        first_date=checkTime(first_date);
        var last_day=last(today);
        var last_mouth=last_day.getMonth()+1;
        last_mouth=checkTime(last_mouth);
        var last_date=last_day.getDate();
        last_date=checkTime(last_date);
        document.getElementById('first').innerHTML="本周("+first_mouth+"."+first_date+"~"+last_mouth+"."+last_date+")开馆音乐：";
        document.getElementById('last').innerHTML="本周("+first_mouth+"."+first_date+"~"+last_mouth+"."+last_date+")闭馆音乐：";
    }
    function first(today){
        var week = today.getDay();
        if(week==0){
            week=7;
        }
        today.setDate(today.getDate()-week+1);
        return today;
    }
    function last(today){
        var week = today.getDay();
        if(week==0){
        week=7;
        }
        today.setDate(today.getDate()-week+7);
        return today;
    }
</script>
<script>
    //提交书籍信息
    function before_up(){
        console.log($("#bookName").val());
        console.log($("#bookAuthor").val());
        console.log($("#bookPublish").val());
        console.log($("#publishTime").val());
        console.log($("#bookNumber").val());
        console.log($("#bookPage").val());
        console.log($("#bookPlace").val());
        console.log($("#bookIntroduction").val());
        console.log($("#type").val());
        console.log($("#description").val());
        if($("#bookName").val()==""||$("#bookAuthor").val()==""||$("#bookPublish").val()==""||$("#publishTime").val()==""||$("#bookNumber").val()==""||$("#bookPage").val()==""||$("#bookPlace").val()=="none"||$("#bookIntroduction").val()==""||$("#type").val()=="none"||$("#description").val()=="none"){
            alert("请输入全部信息和图片！");
            return false;
        }else{
            var bookPlaceP=$("#bookPlace").val();
            $.ajax({            
                //几个参数需要注意一下
                type: "get",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "https://starlibrary.online/penghao/book/addbook",//url
                data: {
                    bookName:$("#bookName").val(),
                    bookAuthor:$("#bookAuthor").val(),
                    bookPublish:$("#bookPublish").val(),
                    publishTime:$("#publishTime").val(),
                    bookNumber:$("#bookNumber").val(),
                    bookPage:$("#bookPage").val(),
                    bookIntroduction:$("#bookIntroduction").val(),
                    bookPlace:bookPlaceP,
                    type:$("#type").val()
                },      
                success: function (result) {                    
                    console.log(result);//打印服务端返回的数据(调试用)
                    if (result.status==200) {
                        alert(result.msg+"窗口即将关闭");
                        $("#description").val(result.data);
                        console.log("description："+$("#description").val());
                        var formData = new FormData($('#uploadForm')[0]);
                        $.ajax({            
                            //几个参数需要注意一下
                            type: "post",//方法类型
                            dataType: "json",//预期服务器返回的数据类型
                            url: "https://starlibrary.online/penghao/book/trimage",//url
                            data: formData,
                            cache: false,
                            processData: false,
                            contentType: false,               
                            success: function (result) {                    
                                console.log(result);//打印服务端返回的数据(调试用)
                                if (result.status==200) {
                                    window.close(); 
                                }else if(result.status==404){
                                    alert(result.msg);
                                }else{
                                    alert("系统错误！错误码："+result);
                                }
                            },
                            error : function(XMLHttpRequest, textStatus, errorThrown){
                                console.log(XMLHttpRequest.status);
                                console.log(XMLHttpRequest.readyState);
                                console.log(textStatus);
                            }
                        });
                    }else if(result.status==404){
                        alert(result.msg);
                        return false;
                    }else{
                        alert("系统错误！错误码："+result);
                        return false;
                    }
                },
                error : function(XMLHttpRequest, textStatus, errorThrown){
                    return false;
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                }
            });
        }
    }
    //预览图片
    function changepic(obj) {
        var newsrc=getObjectURL(obj.files[0]);
        $("#description").val("have");
        $("#show").css("background-image","url("+newsrc+")");
    }
    //建立一個可存取到該file的url
    function getObjectURL(file) {
        var url = null ;
        // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }
</script>
<script>
    //设置所有floor
    $.ajax({
        type:"get",
        dataType:"json",
        url:"https://starlibrary.online/penghao/manager/floor2",
        success:function(result){
            console.log(result);//打印服务端返回的数据(调试用)
            console.log(result.data.length);
            if (result.status==200) {
                    for(var i=0;i<result.data.length;i++){
                        $("#bookPlace").append("<option value=\'"+result.data[i].floor+"\'>"+result.data[i].floor+"</option>");
                    }
                }else if(result.status==404){
                    alert(result.msg);
                }else{
                    alert("系统错误！错误码："+result);
            }
        },
        error : function(XMLHttpRequest, textStatus, errorThrown){
            console.log(XMLHttpRequest.status);
            console.log(XMLHttpRequest.readyState);
            console.log(textStatus);
        }
    })
</script>
<!--超时js-->
<script>
    var lastTime = new Date().getTime();
        var currentTime = new Date().getTime();
        var timeOut = 20* 60 * 1000; //设置超时时间： 20分

        $(function(){
            /* 鼠标移动事件 */
            $(document).mouseover(function(){
                lastTime = new Date().getTime(); //更新操作时间

            });
        });

        function testTime(){
            currentTime = new Date().getTime(); //更新当前时间
            if(currentTime - lastTime > timeOut){ //判断是否超时
                window.location.href="https://starlibrary.online/timeout.html"
            }
        }

        /* 定时器  间隔1秒检测是否长时间未操作页面  */
        window.setInterval(testTime, 6000);
</script>
</html>