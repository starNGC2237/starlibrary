<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../../css/anchor.css">
    <link rel="stylesheet" type="text/css" href="../../css/user/root/adminManger.css">
    <title>root</title>
</head>
<body>
    <!--头部导航栏-->
    <div style="width: 100vw;height: 12vh;background-color: #181818; display: flex; align-items: center;justify-content: space-between;">
        <span style="font-size: 5vmin;margin-left:15vw;color: white;font-family: Georgia, 'Times New Roman', Times, serif;"><a href="https://starlibrary.online" class="footer">StarLibrary</a></span>
        <div style="margin-right: 15vw;">
            <ul style="list-style: none;margin: 0;padding: 0;display: flex;justify-content: flex-start; align-items: center;" >
                <div class="headPicture" style="background-image: url(../../img/white/int.png);" >
                </div>
                <li class="li_margin">
                    <a href=""  class="footer" >English</a>
                </li>
                <div class="headPicture" style="background-image: url(../../img/white/time.png);" >
                </div>
                <li class="li_margin" >
                    <a href="" id="time" class="footer"id="time" >北京时间</a>
                </li>
                <div class="headPicture" style="background-image: url(../../img/white/user.png);" >
                </div>
                <li class="li_margin">
                    <a href="" class="footer" id="loginCookie_check" >登录</a>
                </li>
                <div class="headPicture" style="background-image: url(../../img/white/feedBack.png);" >
                </div>
                <li class="li_margin">
                    <a href="../../feedBack.html" class="footer" >反馈</a>
                </li>
                <div class="headPicture" style="background-image: url(../../img/white/search.png);" >
                </div>
            </ul> 
        </div>
    </div>
    <!--中间的部分-->
    <div style="width: 100vw;height: 88vh;display: flex;align-items: center;">
        <!--具体表格-->
        <div style="width: 50vw;height: 70vh;background-color: #f2f3f5;margin: 0 auto;display: flex;flex-direction: column;align-items: center;">
            <span style="  width: 15vw;height: 4vh;margin-top: 5vmax;" id="adminName"></span>
            <span style=" width: 15vw;height: 4vh;margin-top: 5vmin;" id="adminNickName"></span>
            <select name="" id="floor" style="width: 15vw;height: 4vh;margin-top: 5vmin;">

            </select>
            <span style="width: 15vw;height: 4vh;margin-top: 5vmin;" id="createTime"></span>
            <div style="width: 25vw;height: 4vh;margin-top: 5vmax;display: flex;justify-content: center">
                <input type="button" value="删除" id="button_delete" style="width: 4vw;height: 3vh;margin-right: 5vw;" onclick="admin_delete();" >
                <input type="button" value="保存" id="button_save" style="width: 4vw;height: 3vh;" onclick="admin_save();">
            </div>
        </div>
    </div>
    <!--底部导航栏-->
    <div style="width: 100vw;height: 40vh;background-color:#181818;display: flex; align-items: center; justify-content: space-between;color: white; min-height: 190px;">
        <div  style="height: 30vh; width: 35vw;margin-left: 15vw;">
            <ul style="list-style: none;font-size: 2vmin;padding: 0;" >
                <li style="margin-bottom: 2vh;">
                    <span style="font-size: 5vmin;font-family: Georgia, 'Times New Roman', Times, serif;" >
                       <a href="https://starlibrary.online" class="footer" >StarLibrary</a> 
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                       © 2020-2021 <a href="https://starlibrary.online" class="footer" >starlibrary.com </a>版权所有
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        本网站仅供学习使用
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        ICP证：<a href="http://www.beian.miit.gov.cn" class="footer" >津ICP备20000024号</a> 
                    </span>  
                </li>
                <li class="li_footer">
                    <img src="../../img/备案图标.png" alt="" height="15px"  >
                    <span>
                        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?spm=5176.12825654.7y9jhqsfz.111.54212c4aBH6Hwq" class="footer">苏公网安备 32021402001231号</a> 
                    </span> 
                </li>
            </ul>
        </div>
        <div  style="height: 30vh; width: 35vw;margin-right: 15vw; display: flex; justify-content: flex-end;">
            <div style=" margin: 0 auto;margin-top: 5vh;font-size: 2vmin;">
                <dl>
                    <dt id="first" >
                        本周开馆音乐：
                    </dt>
                    <dd>
                        Xenogenesis
                    </dd>
                </dl>
                <dl>
                    <dt id="last"> 
                        本周闭馆音乐：
                    </dt>
                    <dd>
                        Dreamer
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</body>
<script src="../../js/tools/jquery-3.4.1.js"></script>
<script src="../../js/cookie.js"></script>
<!--导航栏-->
<script>
    //中文的日期
        function startTime(){
            var today=new Date();
            var year=today.getFullYear();
            var month=today.getMonth()+1;
            var day=today.getDate();
            var hours=today.getHours();
            var minutes=today.getMinutes();
            var seconds=today.getSeconds();// add a zero in front of numbers<10
            minutes=checkTime(minutes);
            seconds=checkTime(seconds);
            $("#time").html(year+"年"+month+"月"+day+"日"+hours+":"+minutes+":"+seconds);
            setInterval("startTime()",1000)
        }
        function checkTime(i){
            if (i<10) {
                i="0" + i;
            }
            return i;
        }
        //加载在这里！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
        $(document).ready(function(){
            setInterval("startTime()",1000);
            weeks();
            checkCookie("rootName");
        });
        //这里是检查登录情况！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
        function checkCookie(cname){
            var root= getCookie(cname);
            var nickName=getCookie("rootNickName");
            if (root != "") {
                document.getElementById('loginCookie_check').innerHTML=nickName;
            }
            else{
                window.location.href="https://starlibrary.online/user/admin/root.html";
            }
        }
        function weeks(){
            var today=new Date();
            var first_day=first(today);
            var first_mouth=first_day.getMonth()+1;
            first_mouth=checkTime(first_mouth);
            var first_date=first_day.getDate();
            first_date=checkTime(first_date);
            var last_day=last(today);
            var last_mouth=last_day.getMonth()+1;
            last_mouth=checkTime(last_mouth);
            var last_date=last_day.getDate();
            last_date=checkTime(last_date);
            document.getElementById('first').innerHTML="本周("+first_mouth+"."+first_date+"~"+last_mouth+"."+last_date+")开馆音乐：";
            document.getElementById('last').innerHTML="本周("+first_mouth+"."+first_date+"~"+last_mouth+"."+last_date+")闭馆音乐：";
        }
        function first(today){
            var week = today.getDay();
            if(week==0){
                week=7;
            }
            today.setDate(today.getDate()-week+1);
            return today;
        }
        function last(today){
            var week = today.getDay();
            if(week==0){
            week=7;
            }
            today.setDate(today.getDate()-week+7);
            return today;
        }
</script>
<script>
    //获得能创建的楼层
        $.ajax({ 
            type: "get",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "https://starlibrary.online/penghao/manager/floor2" ,//url      
            success: function (result) {                    
                console.log(result);//打印服务端返回的数据(调试用)
                console.log(result.data.length);
                if (result.status==200) {
                    for(var i=0;i<result.data.length;i++){
                        $("#floor").append("<option value='"+result.data[i].floor+"'>"+result.data[i].floor+"</option>");
                    }
                    after()
                }else if(result.status==404){
                    alert(result.msg);
                }else{
                    alert("系统错误！错误码："+result);
                }
            },
            error : function(XMLHttpRequest, textStatus, errorThrown){
                console.log(XMLHttpRequest.status);
                console.log(XMLHttpRequest.readyState);
                console.log(textStatus);
            }
        });
    function after(){
        $.ajax({ 
            type: "get",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "https://starlibrary.online/penghao/manager/login" ,//url
            data: {
               userName:getCookie("keyAdminName")
            },             
            success: function (result) {                    
                console.log(result);//打印服务端返回的数据(调试用)
                if (result.status==200&&result.data.userName==getCookie("keyAdminName")) {
                    //返回并设置所有信息
                    $("#adminName").append("管理员用户名："+result.data.userName);
                    $("#adminNickName").append("管理员昵称："+result.data.nickName);
                    $("#floor").append("<option value='"+result.data.floor+"'>"+result.data.floor+"</option>");
                    setCookie("keyFloor",result.data.floor,1);
                    $("#floor").val(result.data.floor);
                    $("#createTime").append("创建时间："+result.data.createTime);
                }else if(result.status==404){
                    alert(result.msg);
                }else{
                    alert("系统错误！错误码："+result);
                }
            },
            error : function(XMLHttpRequest, textStatus, errorThrown){
                console.log(XMLHttpRequest.status);
                console.log(XMLHttpRequest.readyState);
                console.log(textStatus);
            }
        });
    }
    function admin_save(){
            if(getCookie("keyFloor")==$("#floor").val()){
                alert("您没有进行楼层更改！");
            }else{
                $.ajax({ 
                    //TODO 修改楼层
                    type: "get",//方法类型
                    dataType: "json",//预期服务器返回的数据类型
                    url: "https://starlibrary.online/penghao/vipmanager/revise" ,//url
                    data: {
                        userName:getCookie("keyAdminName"),
                        floor:$("#floor").val(),
                        oldFloor:getCookie("keyFloor")
                    }, 
                    success: function (result) {                    
                        console.log(result);//打印服务端返回的数据(调试用)
                        if (result.status==200) {
                            alert(result.msg);
                            window.location.href="adminManger.html";
                        }else if(result.status==404){
                            alert(result.msg);
                        }else{
                            alert("系统错误！错误码："+result);
                        }
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown){
                        console.log(XMLHttpRequest.status);
                        console.log(XMLHttpRequest.readyState);
                        console.log(textStatus);
                    }
                });
            }
            
    }
    //TODO 删除管理员
    function admin_delete(){
            $.ajax({ 
                type: "get",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "https://starlibrary.online/penghao/vipmanager/deletemanager" ,//url
                data: {
                    userName:getCookie("keyAdminName"),
                    floor:getCookie("keyFloor")
                },             
                success: function (result) {                    
                    console.log(result);//打印服务端返回的数据(调试用)
                    if (result.status==200) {
                        alert(result.msg);
                        window.location.href="adminManger.html"
                    }else if(result.status==404){
                        alert(result.msg);
                    }else{
                        alert("系统错误！错误码："+result);
                    }
                },
                error : function(XMLHttpRequest, textStatus, errorThrown){
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                }
            });
        //}
    }
</script>
</html>