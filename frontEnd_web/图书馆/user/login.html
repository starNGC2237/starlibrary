<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../css/anchor.css">
    <link rel="stylesheet" type="text/css" href="../css/user/login.css">
    <title>我的图书馆</title>
</head>
<body>
    <div style="width: 100vw;height: 100vh;background-image: url();background-repeat: no-repeat;background-size: cover;background-position: center;" 
     id="anchor1" >
        <!--头部导航栏-->
        <div style="width: 100vw;height: 12vh;display: flex; align-items: center;justify-content: space-between;">
            <span style="font-size: 5vmin;margin-left:15vw;color: white;font-family: Georgia, 'Times New Roman', Times, serif;"><a href="https://starlibrary.online" class="footer">StarLibrary</a></span>
                <div style="margin-right: 15vw;">
                    <ul style="list-style: none;margin: 0;padding: 0;display: flex;justify-content: flex-start; align-items: center;" >
                        <div class="headPicture" style="background-image: url(../img/white/int.png);">
                        </div>
                        <li class="li_margin">
                            <a href="../English/index.html" class="footer">English</a>
                        </li>
                        <div class="headPicture" style="background-image: url(../img/white/time.png);">
                        </div>
                        <li class="li_margin">
                            <a href="https://starlibrary.online/clock.html" id="time" class="footer"id="time" >北京时间</a>
                        </li>
                        <div class="headPicture" style="background-image: url(../img/white/user.png);">
                        </div>
                        <li class="li_margin">
                            <a  href="" class="footer" id="loginCookie_check" >登录</a>
                        </li>
                        <div class="headPicture" style="background-image: url(../img/white/feedBack.png);" >
                        </div>
                        <li class="li_margin">
                            <a href="../feedBack.html" class="footer" >反馈</a>
                        </li>
                        <div class="headPicture" style="background-image: url(../img/white/search.png);">
                        </div>
                    </ul>
                </div>
        </div>
        <!--登录栏及图片-->
        <div style="width: 100vw;height: 88vh; display: flex; flex-direction: column;">
            <div style="width: 80vw;height: 80vh;margin: 0 auto; display: flex;">
                <div style="width: 40vw;height: 80vh;">
                   <!--图片-->
                </div>
                <div style="width: 40vw;height: 80vh;display: flex;align-items: center;">
                    <div style="width: 35vw;height: 70vh;margin: 0 auto;display: flex;flex-direction: column;box-shadow: 10px 10px 10px #000000a9;">
                        <div style="width: 35vw;height: 8vh;display: flex;">
                            <div style="width:17.5vw;height: 8vh;background-color: red;display: flex;align-items: center;cursor: pointer;" id="otherWay">
                                <span style="margin: 0 auto;font-size: 1vmax;color: white;">
                                    扫码登录
                                </span>
                            </div>
                            <div style="width: 17.5vw;height: 8vh;background-color: blue;display: flex;align-items: center;cursor: pointer;"id="oneWay">
                                <span style="margin: 0 auto;font-size: 1vmax;color: white;" >
                                    密码登录
                                </span>
                            </div>
                        </div>
                        <div style="width: 35vw;height: 62vh;background-color: red;display: flex;flex-direction: column;" id="otherWayWrite">
                            <div style="width: 35vw;height: 40vh;background-color: blueviolet;display: flex;flex-direction: column;">
                                <form method="POST" onsubmit=" return submit_login();" id="formLogin">
                                    <div style="width: 35vw;height: 40vh;background-color: blue;display: flex;flex-direction: column;justify-content: center;align-items: center;">
                                        <input type="text" name="userName" autocomplete="off" placeholder="用户名"  id="userName" class="input_text_login" style="margin-top: 5vh;" >
                                        <input type="password" name="passWord" autocomplete="off" placeholder="密码" class="input_text_login">
                                        <input type="submit" value="登录" type="button"class="input_button_login">
                                    </div>
                                </form>
                            </div>
                            <div style="width: 35vw;height: 22vh;background-color: blue;display: flex;justify-content: flex-end;" >
                                <div class="href_div">
                                    <span><a href="register.html" class="footer" >注册</a></span>
                                    <span><a href="change.html" class="footer" style="margin-right: 8vw;margin-left: 1vmin;" >忘记密码</a></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--底部导航栏-->
    <div style="width: 100vw;height: 40vh;background-color:#181818;display: flex; align-items: center; justify-content: space-between;color: white; min-height: 190px;">
        <div  style="height: 30vh; width: 35vw;margin-left: 15vw;">
            <ul style="list-style: none;font-size: 2vmin;padding: 0;">
                <li style="margin-bottom: 2vh;">
                    <span style="font-size: 5vmin;font-family: Georgia, 'Times New Roman', Times, serif;" >
                       <a href="https://starlibrary.online" class="footer" >StarLibrary</a> 
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                       © 2020-2021 <a href="https://starlibrary.online" class="footer" >starlibrary.com </a>版权所有
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        本网站仅供学习使用
                    </span> 
                </li>
                <li class="li_footer">
                    <span>
                        ICP证：<a href="http://www.beian.miit.gov.cn" class="footer" >津ICP备20000024号</a> 
                    </span>  
                </li>
                <li class="li_footer">
                    <img src="../img/备案图标.png" alt="" height="15px"  >
                    <span>
                        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?spm=5176.12825654.7y9jhqsfz.111.54212c4aBH6Hwq" class="footer">苏公网安备 32021402001231号</a> 
                    </span> 
                </li>
            </ul>
        </div>
        <div  style="height: 30vh; width: 35vw;margin-right: 15vw; display: flex; justify-content: flex-end;">
            <div style=" margin: 0 auto;margin-top: 5vh;font-size: 2vmin;">
                <dl>
                    <dt id="first" >
                        本周开馆音乐：
                    </dt>
                    <dd>
                        Xenogenesis
                    </dd>
                </dl>
                <dl>
                    <dt id="last"> 
                        本周闭馆音乐：
                    </dt>
                    <dd>
                        Dreamer
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</body>
<script src="../js/tools/jquery-3.4.1.js"></script>
<script src="../js/tools/login.js"></script>
<script src="../js/cookie.js"></script>
<script src="../js/tools/qrcode.js"></script>
<!--顶部导航栏和底部导航栏的js-->
<script>
    //中文的日期
    function startTime(){
        var today=new Date();
        var year=today.getFullYear();
        var month=today.getMonth()+1;
        var day=today.getDate();
        var hours=today.getHours();
        var minutes=today.getMinutes();
        var seconds=today.getSeconds();// add a zero in front of numbers<10
        minutes=checkTime(minutes);
        seconds=checkTime(seconds);
        $("#time").html(year+"年"+month+"月"+day+"日"+hours+":"+minutes+":"+seconds);
        setInterval("startTime()",1000)
    }
    function checkTime(i){
        if (i<10) {
            i="0" + i;
        }
        return i;
    }

    //加载在这里！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
    $(document).ready(function(){
        setInterval("startTime()",1000);
        weeks();
        checkCookie("userName");
    });
    //这里是检查登录情况！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
    function checkCookie(cname){
        var user = getCookie(cname);
        var nickName=getCookie("nickName");
        if (user != "") {
            window.location.href="message.html"
        }
    }
    function weeks(){
        var today=new Date();
        var first_day=first(today);
        var first_mouth=first_day.getMonth()+1;
        first_mouth=checkTime(first_mouth);
        var first_date=first_day.getDate();
        first_date=checkTime(first_date);
        var last_day=last(today);
        var last_mouth=last_day.getMonth()+1;
        last_mouth=checkTime(last_mouth);
        var last_date=last_day.getDate();
        last_date=checkTime(last_date);
        document.getElementById('first').innerHTML="本周("+first_mouth+"."+first_date+"~"    +last_mouth+"."+last_date+")开馆音乐：";
        document.getElementById('last').innerHTML="本周("+first_mouth+"."+first_date+"~" +last_mouth+"."+last_date+")闭馆音乐：";
    }
    function first(today){
        var week = today.getDay();
        if(week==0){
            week=7;
        }
        today.setDate(today.getDate()-week+1);
        return today;
    }
    function last(today){
        var week = today.getDay();
        if(week==0){
        week=7;
        }
        today.setDate(today.getDate()-week+7);
        return today;
    }
    if(getCookie('urlPicture')!=""){
        $("#anchor1").css("background-image","url("+getCookie('urlPicture')+")");
        $("#tips").attr("title",getCookie('contentPicture'));
    }else{
        setCookie("contentPicture","风景图",360);
        setCookie("urlPicture","https://starlibrary.online/image/123.jpg",360);
        $("#anchor1").css("background-image","url("+getCookie('urlPicture')+")");
    }
</script>
<!--用来改变页面的-->
<script>
    //生成从minNum到maxNum的随机数
    function randomNum(minNum,maxNum){ 
        switch(arguments.length){ 
            case 1: 
                return parseInt(Math.random()*minNum+1,10); 
            break; 
            case 2: 
                return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10); 
            break; 
            default: 
                return 0; 
            break; 
        } 
    } 
    var uuid=0;
    $("#otherWay").click(function(){
        $("#otherWayWrite").css({
            "flex-direction" : "column",
            "justify-content" : "center",
            "align-items": "center"
        });
        $("#otherWayWrite").empty();
        if(uuid==0){
            $.ajax({            
                //几个参数需要注意一下
                type: "get",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "https://starlibrary.online/haopeng/user/queryUUID",//url           
                success: function (result) {                    
                    console.log(result);//打印服务端返回的数据(调试用)
                    if (result.status==200) {
                        uuid=result.data;
                        var u="https://starlibrary.online/haopeng/user/revisestatus"
                        s="{\"uuid\":\""+uuid+"\",\"interfaceHave\":\""+u+"\"}";
                        var qrcode = new QRCode(document.getElementById("otherWayWrite"), {
	                    text: s,
	                    width: 180,
	                    height: 180,
	                    colorDark : "#000000",
	                    colorLight : "#ffffff",
	                    correctLevel : QRCode.CorrectLevel.H});
                        $("#otherWayWrite").css("title","");
                        window.setInterval(setFunction, 1000 * 3); //每3秒执行一次setFunction()方法
                        $("#otherWayWrite").append("<p id='qcode'></p>")
                    }else if(result.status==404){
                        alert(result.msg);
                    }else{
                        alert("系统错误！错误码："+result);
                    }
                },
                error : function(XMLHttpRequest, textStatus, errorThrown){
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                }
            });
        }else{
            var u="https://starlibrary.online/haopeng/user/revisestatus"
                        s="{\"uuid\":\""+uuid+"\",\"interfaceHave\":\""+u+"\"}";
                        var qrcode = new QRCode(document.getElementById("otherWayWrite"), {
	                    text: s,
	                    width: 180,
	                    height: 180,
	                    colorDark : "#000000",
	                    colorLight : "#ffffff",
	                    correctLevel : QRCode.CorrectLevel.H});
        }
        
    });
    $("#oneWay").click(function(){
        $("#otherWayWrite").css({
            "flex-direction" : "column",
            "justify-content" : "flex-start"
        });
        $("#otherWayWrite").empty();
        $("#otherWayWrite").append('<div style="width: 35vw;height: 40vh;background-color: blueviolet;display: flex;flex-direction: column;"><form method="POST" onsubmit=" return submit_login();" id="formLogin"><div style="width: 35vw;height: 40vh;background-color: blue;display: flex;flex-direction: column;justify-content: center;align-items: center;"><input type="text" name="userName" autocomplete="off" placeholder="用户名"  id="userName" class="input_text_login" style="margin-top: 5vh;" ><input type="password" name="userPassword" autocomplete="off" placeholder="密码" class="input_text_login"><input type="submit" value="登录" type="button"class="input_button_login"></div></form></div><div style="width: 35vw;height: 22vh;background-color: blue;display: flex;justify-content: flex-end;" ><div class="href_div"><span><a href="register.html" class="footer" >注册</a></span><span><a href="change.html" class="footer" style="margin-left: 1vmin;" >忘记密码</a></span><span><a href="https://starlibrary.online/user/admin/books.html" target="_blank"  class="footer" style="margin-right: 8vw;margin-left: 1vmin;">后台<a><span></div></div>')
    });
    var i = 1;
    function setFunction() {
        console.log("开始执行任务、执行次数=======>" + (i++));
        //此时就是自己的方法处理方式 比如调用后台或者其他操作
        $.ajax({            
                //几个参数需要注意一下
                type: "get",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "https://starlibrary.online/haopeng/user/querystatus?uuid="+uuid,//url           
                success: function (result) {                    
                    console.log(result);//打印服务端返回的数据(调试用)
                    if (result.status==200) {
                        if(result.data==2){
                            document.getElementById("qcode").innerHTML="正在登录。。。";
                            $.ajax({            
                                type: "get",//方法类型
                                dataType: "json",//预期服务器返回的数据类型
                                url: "https://starlibrary.online/haopeng/user/queryuserbyuuid?uuid="+uuid,//url           
                                success: function (result) {                    
                                    console.log(result);//打印服务端返回的数据(调试用)
                                    if (result.status==200) {
                                        setCookie("userHeadPic",result.data.src,7);
                                        setCookie("card",result.data.card,7);
                                        setCookie("userName",result.data.userName,7);
                                        setCookie("nickName",result.data.nickName,7);
                                        window.location.href="https://starlibrary.online";
                                    }else if(result.status==404){
                                        alert(result.msg);
                                    }else{
                                        alert("系统错误！错误码："+result);
                                    }
                                },
                                error : function(XMLHttpRequest, textStatus, errorThrown){
                                    console.log(XMLHttpRequest.status);
                                    console.log(XMLHttpRequest.readyState);
                                    console.log(textStatus);
                                }
                            });
                        }else if(result.data==1){
                            document.getElementById("qcode").innerHTML="正在确认。。。";
                        }
                    }else if(result.status==404){
                        alert(result.msg);
                    }else{
                        alert("系统错误！错误码："+result);
                    }
                },
                error : function(XMLHttpRequest, textStatus, errorThrown){
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                }
        });
    }
</script>
</html>